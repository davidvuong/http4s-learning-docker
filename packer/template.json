{
  "variables": {
    "home": "{{env `HOME`}}"
  },
  "builders": [{
    "type": "docker",
    "image": "imageintelligence/scala",
    "export_path": "image.tar",
    "run_command": [
      "--publish-all",
      "--workdir", "/app",
      "-d", "-i", "-t",
      "{{.Image}}",
      "sbt", "compile"
    ]
  }],
  "provisioners": [
    {
      "type": "file",
      "source": "{{pwd}}/",
      "destination": "/root/app"
    },
    {
      "type": "file",
      "source": "{{user `home`}}/.sbt/",
      "destination": "/root/.sbt"
    },
    {
      "type": "file",
      "source": "{{user `home`}}/.ivy2/",
      "destination": "/root/.ivy2"
    },
    {
      "type": "shell",
      "inline": [
        "cd /root/app",
        "sbt compile"
      ]
    }
  ],
  "post-processors": [
    [
      {
        "type": "docker-import",
        "repository": "imageintelligence/http4sbin-learning-docker"
      },
      "docker-push"
    ]
  ]
}
